{{! Fetch the feed's content }}
{{assign 'data' (fetchFeed (combine __params__.feed '?eventID=' __params__.id))}}

{{! Assign called event data to event object }}
{{assign 'event' data.0}}

{{#if event}}

  {{! Set the title to be the title of the event }}
  {{assign 'title' event.title}}
  {{assign 'system.title' title}}

  {{! Set the subtitle to be the date of the event }}
  {{assign 'subtitle' event.dateTimeFormatted}}

  {{! Set the hero image (This could be bad)}}
  {{assign 'hero' event.eventImage.url}}

  {{! Add location to sections object for sidebar list}}
  {{assign 'location' (objectify content=(sanitize event.location) icon="material-map" title="Location")}}

  {{storagePush 'sections' location}}

  {{! Loop through custom fields to get sidebar list items}}
  {{#each event.customFields}}
    {{assign 'title' label}}
    {{#if (indexOf value ',')}}
     {{assign 'content' (split value ",")}}
    {{else}}
      {{assign 'content' value}}
    {{/if}}

    {{#if (eq label 'Cost')}}
      {{assign 'icon' 'material-attach_money'}}
      {{storagePush 'sections' this}}
    {{/if}}

    {{#if (eq label 'Speaker')}}
      {{assign 'icon' 'material-person'}}
      {{storagePush 'sections' this}}
    {{/if}}

    {{#if (eq label 'Department / Organization')}}
      {{assign 'title' 'Department'}}
      {{assign 'icon' 'material-office'}}
      {{storagePush 'sections' this}}
    {{/if}}

    {{#if (eq label 'Contact Name')}}
      {{storageSet 'contact-name' value}}
    {{/if}}

    {{#if (eq label 'Contact Email')}}
      {{assign 'title' 'Contact'}}
      
      {{assign 'content' (combine (storageGet 'contact-name') '<br><a href=\"mailto:' (sanitize value) '\">' (sanitize value) '</a>' ) }}

      {{assign 'icon' 'material-mail'}}
      {{storagePush 'sections' this}}
    {{/if}}
  {{/each}}

  {{! set the button values}}
  {{assign 'button' (objectify href=event.signUpUrl label="Register Now")}}

  {{! Set the looped sections to the sections array }}
  {{assign 'sections' (storageGet 'sections')}}

  {{! Get event topics }}
  {{#each event.customFields}}
    {{#if (eq label 'University Event Topic')}}
      {{storageSet 'topics' value}}
    {{/if}}
  {{/each}}

  {{! Assign topics }}
  {{assign 'topics' (storageGet 'topics')}}

  {{! Set (decoded) related topics value }}
  {{assign 'topics' (decodeHTML topics)}}

{{/if}}

<div class="event-page">
  <header class="event-page-header"></header>
  <div class="event-page-main">
    {{#unless event}}
      {{>organisms-intro-alt-text title="Event Not Found"}}
    {{/unless}}
    {{#extend 'organisms-main' type="event-page" classes="event-page-main"}}
      {{#content 'section-main-body'}}
        {{! If eventID isn't found...}}
        {{#if event}}
          {{> tokens-text rich=true text=event.description}}
          {{>atoms-rule}}
          {{>tokens-heading level=6 heading="Related University Event Topics"}}
          {{>tokens-text text=topics}}
        {{/if}}
      {{/content}}
      {{#if event}}
      {{#content 'section-main-sidebar'}}
        {{>compounds-sidebar-list}}
      {{/content}}
      {{/if}}
    {{/extend}}
  </div>
  <footer class="event-page-footer"></footer>
</div>
